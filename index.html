<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />

    <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css"> 
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.0.4/angular.js"></script>
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
   <!-- <script type="text/javascript" src="js/controller.js"></script> -->
    <script type="text/javascript" src="https://www.google.com/jsapi"></script> 
 <script type="text/javascript">
    
// Include the google charts api and manually bootstrap the angular
// app defined in controller.js once the api has been loaded.
google.load('visualization', '1', {packages: ['corechart']});
google.setOnLoadCallback(function() {
	angular.bootstrap(document.body, ['snowy']);
    });

var snowy = angular.module('snowy',[]);

snowy.controller('ButtonController', ['$scope', function($scope) {

	    // Create the chart that will be used to animate resort-by-resort information.
	    $scope.chart= new google.visualization.ColumnChart(document.getElementById('visualization_div'));	    

	    // State the options here, since they are a bit cumbersome
	    // to have inline in the JavaScript function.  This
	    // variable shouldn't be exposed to other controllers, so
	    // I'm not adding it to the scope.
	    
	   var options = { "titleTextStyle": { color: "black",
						fontName: "Open Sans",
						fontSize: 16,
						bold: false,
						italic: false },
			    "title":"Session Hours Provided by University of Portland Librarians",
			    "titleFontSize": 12,
			    "animation": {
				startup: true,
				duration: 850,
				easing: 'in'
			    },
			    "bar": {"groupWidth": "95%"},
			    "vAxis": {"title": "Session Hours",
				      "viewWindow" : {max : 3000}, 
				      "textStyle" : { color: "black",
						      fontName: "Open Sans",
						      fontSize: 12,
						      bold: false,
						      italic: false },
				      "titleTextStyle" : { color: "black",
							   fontName: "Open Sans",
							   fontSize: 16,
							   bold: false,
							   italic: false }},    
			    "hAxis": {"title": "Month",
				      "textStyle" : { color: "black",
						      fontName: "Open Sans",
						      fontSize: 12,
						      bold: false,
						      italic: false },
				      "titleTextStyle" : { color: "black",
							   fontName: "Open Sans",
							   fontSize: 16,
							   bold: false,
							   italic: false }},
			    "legend": { "position": "none" }
	    };
	
		/**
		  var options = {
        chart: {
          title: 'Annual Snowfall at,
          subtitle: 'Mt. Baker'
        },
        width: 900,
        height: 500
      };
 **/
	    // Make the initial query to get the whole Fusion table.
	    var query = "SELECT Resort, 'Annual Snowfall', Year FROM 1AoZsRLfcNALHsaHrhBxi1ZuqahhlcOCP_P6CYLJL";	    
	    var opts = {sendMethod: 'auto'};
	    var queryObj = new google.visualization.Query('https://www.google.com/fusiontables/gvizdata?tq=', opts);
	       
	    
	    // Define the variables to hold the entire fusion table,
	    // and a collection of views, one for each year.
	    var data;
	    var views = {};
	    
	    // Send the query and handle the response by creating and
	    // drawing the data for 2014.
	    queryObj.setQuery(query);
	    queryObj.send(function(e) { 
		    
		    data = e.getDataTable();
		    
		    // Create a view for resort that is the first two columns of 
		    // the data, just the rows that have 2014 for the value.
		    var thisResort = $scope.resort;
                    views[thisResort] = new google.visualization.DataView(data);
                    views[thisResort].setRows(views[thisResort].getFilteredRows([{column: 0, value: thisResort}]));
		    views[thisResort].setColumns([2, 1]);

		    // Draw the chart for 2014.
		    $scope.chart.draw(views[thisResort].toDataTable(), options);
		});	

	       		
	    // At the start of execution, the year is 2014, the most
	    // recent year that has 12 months of data.
	    $scope.resort = 'mt-baker';


	    // ************************************************************************
	    // Controller functions
	    // ************************************************************************


	    // get()
	    //    Get a new chart.
	    $scope.get = function() {

		// If the view of data for the selected year hasn't been created
		// yet, create it.
		if (views[thisResort] === undefined) {

		    var thisResort = $scope.Resort;
                    views[thisResort] = new google.visualization.DataView(data);
                    views[thisResort].setRows(views[thisResort].getFilteredRows([{column: 2, value: thisResort}]));
                    views[thisResort].setColumns([0, 1]);
		    
		}
		// Draw the chart for selected year.
		$scope.chart.draw(views[thisResort].toDataTable(), options);

	    };

	    // minus():
	    //   Subtract one from the year and get a new chart.
	    $scope.minus = function() {
	  
		$scope.year = $scope.year - 1;
		$scope.get();
	    };

	    // plus():
	    //   Add one to the year and get a new chart.
	    $scope.plus = function() {

		$scope.year = $scope.year + 1;
		$scope.get();
	    };
	   
	}]);
	</script>  
	
	

    <title>The Library Sessions</title>
</head>

    <body style="font-family: 'Open Sans', san-serif ; height: 100%; border: 0 none;">

    	<div class="container"  ng-controller="ButtonController">
	
	
	<div class="row">
	    <div class="col-md-12">
              <h1>The Library Sessions. <small>Visualizing the number of instructional hours offered by the UP librarians to the university community.</small> </h1>
	      </div>
	</div>

	<div google-chart chart="chartObject"></div>

	<div class="row" style="margin-top: 20px">
	  <div class="col-md-3">
	    <div class="input-group">
	      <span class="input-group-btn">
	        <input type="text" class="form-control" ng-model="year">
 		<button class="btn btn-default" type="button" ng-model="year" ng-disabled="year<2003" ng-click="minus()"></button>
		<button class="btn btn-default" type="button" ng-model="year" ng-disabled="year>2013" ng-click="plus()"></button>
	      </span>
	      </div><!-- /input-group -->
	    </div>
	  </div><!-- /.row -->
	  

     <div class="row">
       <div class="cold-md-12">
	 <div id="visualization_div" style="height: 400px; width: 700px;"></div>
       </div>
    </div>
	 
 
<!-- Begin footer content -->
 <footer class="footer">
   <div class="container">
     <p class="text-muted">by Tanya L. Crenshaw</p>
   </div>
 </footer>

</body>
</html>
